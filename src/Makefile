#!/usr/bin/make
#This Makefile was automatically generated by tg2make using the sourcefile <stdin>.

tg2make:tg2make.tg pycfg
	tgtemplate tg2make.tg --comment-prefix=\ \# --dont-comment-square-zero > tg2make
	chmod +x ./tg2make

pycfg:pycfg.tg
	tgtemplate pycfg.tg --comment-prefix=\ \# --dont-comment-square-zero > .pycfg
	mv .pycfg pycfg
	chmod +x ./pycfg

mge:pycfg mge.tg
	tgtemplate mge.tg --comment-prefix=\ \# --dont-comment-square-zero > mge
	chmod +x ./mge

mge-debug:pycfg mge.tg
	tgtemplate mge.tg --comment-prefix=\ \# --dont-comment-square-zero > mge-debug
	chmod +x ./mge-debug

all:tg2make mge module-explorer gradesta_pb2.py
	

code-visualizations/svgs:
	

code-visualizations/keybindings-filled.tg:code-visualizations/keypress-callgraph.tg mge-config.tg code-visualizations/modes.tg code-visualizations/keybindings-generator
	./code-visualizations/keybindings-generator --config-file=mge-config.tg --modes-file=code-visualizations/modes.tg --keypress-call-graph-file=code-visualizations/keypress-callgraph.tg --out=code-visualizations/keybindings-filled.tg

code-visualizations/keypress-callgraph.tg:mge.tg
	tgfilter --street-neq=\#submap --rezero 12 mge.tg > code-visualizations/keypress-callgraph.tg

code-visualizations/keybindings-generator:pycfg code-visualizations/keybindings-generator.tg
	tgtemplate code-visualizations/keybindings-generator.tg --comment-prefix=\ \# --dont-comment-square-zero > code-visualizations/keybindings-generator
	chmod +x code-visualizations/keybindings-generator

module-explorer:pycfg module-explorer.tg
	tgtemplate module-explorer.tg --comment-prefix=\ \# --dont-comment-square-zero > module-explorer
	chmod +x ./module-explorer

gradesta_pb2.py:gradesta.proto
	protoc gradesta.proto --python_out=./

gradesta.proto:gradesta.proto.tg
	tgtemplate gradesta.proto.tg --comment-prefix=\ \/\/ --dont-comment-square-zero > gradesta.proto

gradesta-manager:gradesta_pb2.py gradesta-manager.tg
	tgtemplate gradesta-manager.tg --comment-prefix=\ \# --dont-comment-square-zero > gradesta-manager
	chmod +x ./gradesta-manager

test:gradesta-manager test/gradesta/clients/initialize-get-bookmarks test/gradesta/services/echo-service test/gradesta/clients/minimum-interacitve-cli
	

test/gradesta/clients/initialize-get-bookmarks:gradesta_pb2.py gradesta-manager test/gradesta/clients/initialize-get-bookmarks.tg
	tgtemplate test/gradesta/clients/initialize-get-bookmarks.tg --comment-prefix=\ \# --dont-comment-square-zero > test/gradesta/clients/initialize-get-bookmarks
	chmod +x ./test/gradesta/clients/initialize-get-bookmarks

test/gradesta/services/echo-service:gradesta_pb2.py test/gradesta/services/echo-service.tg
	tgtemplate ./test/gradesta/services/echo-service.tg --comment-prefix=\ \# --dont-comment-square-zero > test/gradesta/services/echo-service
	chmod +x ./test/gradesta/services/echo-service

test/gradesta/clients/minimum-interacitve-cli:gradesta_pb2.py gradesta-manager test/gradesta/clients/minimum-interactive-cli.tg
	tgtemplate test/gradesta/clients/minimum-interactive-cli.tg --comment-prefix=\ \# --dont-comment-square-zero > test/gradesta/clients/minimum-interactive-cli
	chmod +x ./test/gradesta/clients/minimum-interactive-cli

code-visualizations/gradesta.proto.png:code-visualizatons/gradest.proto.dot
	dot -Tpng code-visualizations/gradesta.proto.dot > code-visualizations/gradesta.proto.png

code-visualizatons/gradest.proto.dot:gradesta.proto.tg
	cat gradesta.proto.tg | tg2dot --center 172 --no-street-numbers --no-street-names --no-center-highlight --downstream > code-visualizations/gradesta.proto.dot

